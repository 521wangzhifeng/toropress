<!DOCTYPE html>
<html lang="zh-CN">
    <head>  
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="keywords" content="速动中国,SudoChina,开源技术,开源软件,开源网站,开源源码,开源社区,开源站长社区,golang开源,java开源,perl开源,python开源,ruby开源,php开源,开源项目,开源代码" />
    <meta name="description" content="速动中国 www.sudochina.com 是目前中国最大的开源站长技术社区。我们借助开源的力量，推广使用开源项目建设网站，为站长提供了一个发现、使用、并交流开源站长技术平台。" />
    <meta name="author" content="insion"/>
    
    <title>速动中国 - 借力开源技术，打造心中网站，分享开源技术及站长软件工具，分享运营经验和站长行业交流！</title>
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
  
    
    <link href="/static/themes/nannie/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/themes/nannie/css/font-awesome.css">
          
    <link href="/static/themes/nannie/css/style.css" rel="stylesheet">
    <link href="/static/themes/nannie/css/bootstrap-responsive.css" rel="stylesheet">

    
  
    
    <script type="text/javascript" src="/static/js/ckeditor/plugins/syntaxhighlighter/scripts/shCore.js"></script>
    <script type="text/javascript" src="/static/js/ckeditor/plugins/syntaxhighlighter/scripts/shBrushJScript.js"></script>
    <link type="text/css" rel="stylesheet" href="/static/js/ckeditor/plugins/syntaxhighlighter/styles/shCoreDefault.css"/>
    <link type="text/css" rel="Stylesheet" href="/static/js/ckeditor/plugins/syntaxhighlighter/styles/shThemeEmacs.css"/>
    
    <script type="text/javascript">SyntaxHighlighter.all();</script>
    
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/static/ico/apple-touch-icon-57-precomposed.png">

    <style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
   
    <script type="text/javascript" src="/static/js/jquery-1.8.3.min.js"></script>
</head>

<body>


<header>
   <div class="container">
      <div class="row">
         <div class="span4">
            <div class="logo">
               
               <a href="/"><h1><span class="color">Sudo</span>China</h1></a>
               <p class="lmeta">速动中国，借力开源，快速行动！</p>
            </div>
         
      </div>
   </div>
  </div>
</header>

         <div class="navbar">
            <div class="navbar-inner">
               <div class="container">
                  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                     <span>菜单</span>
                  </a>
                  <div class="nav-collapse collapse">
                      <ul class="nav">
                        <ul id="menu-menu" class="nav">
                        
                        
                          
                          <li class="menu-item"><a href="/">首页</a></li>

                          
                                  <li class="menu-item"><a href="/category/1">
                                    代码</a>
                                  </li>
                          
                                  <li class="menu-item"><a href="/category/2">
                                     笔记</a>
                                  </li>
                          
                                  <li class="menu-item"><a href="/category/3">
                                    下载</a>
                                  </li>
                          
                                  <li class="menu-item"><a href="/category/4">
                                    配置</a>
                                  </li>
                          
                        
                          <li class="menu-item dropdown"><a class="dropdown-toggle" data-toggle="dropdown" data-target="#" href="#">語言 <b class="caret"></b></a>
                          <ul class="dropdown-menu">
                            <li class="menu-item"><a href="?lang=normal">默認語言</a></li>
                            <li class="menu-item"><a href="?lang=cn">簡體中文</a></li>
                            <li class="menu-item"><a href="?lang=hk">繁體中文</a></li>
                          </ul>
                          </li>
                        </ul>
                      </ul>
                  </div>
               </div>
            </div>
         </div>



<div class="content">
   <div class="container">
      <div class="row">
         <div class="span8">
          
<h3 style="display:none;">
   <span>Post</span>
</h3>
<div class="posts">

   <div class="entry" id="post-27">
      <div class="matter">

         <h2>golang mysql留言板系统</h2>

         <div class="meta"> <i class="icon-calendar"></i>
            April 6 , 2013 at 05:55 am - <i class="icon-folder-open"></i>
            <a href="/user/0/" title="View all posts in " rel="category tag"></a>
            -
            <a href="###" title="41个点击">41点击</a>
            -
            <i class="icon-comment"></i>
            <a href="http://responsivewebinc.com/nannie/suspendisse-eget-lorem-dui/#comments" title="0 个评论">0 评论</a>
         </div>

         <div><p><a href="http://www.dotcoo.com/golang-mysql-liuyanban" target="_blank">原文</a></p>

<p>main.go</p>

<pre class="brush: js;">
// Golang简易留言板系统
// Author: dotcoo zhao
 
// mysql
// CREATE TABLE liuyan (
//     id int primary key auto_increment not null,
//     name varchar(20) not null,
//     url varchar(100) not null,
//     content varchar(1000) not null,
//     time int
// ) ENGINE = MYISAM CHARACTER SET utf8 COLLATE utf8_general_ci;
 
// sqlite3
// CREATE TABLE liuyan (
//     id integer primary key autoincrement,
//     name text,
//     url text,
//     content text,
//     time integer
// );
package main
 
import (
    &quot;database/sql&quot;
    &quot;io&quot;
    &quot;net/http&quot;
    &quot;strings&quot;
    &quot;text/template&quot;
    &quot;time&quot;
    // &quot;github.com/ziutek/mymysql/godrv&quot;
    _ &quot;github.com/mattn/go-sqlite3&quot;
)
 
// 留言结构
type Liuyan struct {
    Id      int
    Name    string
    Url     string
    Content string
    Time    int
}
 
// // 显示留言时间
// func (l Liuyan) ShowTime() string {
//     t := time.Unix(int64(l.Time), 0)
//     return t.Format(&quot;2006-01-02 15:04:05&quot;)
// }
 
func ShowTime(timeUnix int) string {
    t := time.Unix(int64(timeUnix), 0)
    return t.Format(&quot;2006-01-02 15:04:05&quot;)
}
 
// 全局变量
var db *sql.DB
var view *template.Template
 
func main() {
    // godrv.Register(&quot;SET NAMES utf8&quot;)
 
    // 连接数据库
    var err error
    // db, err := sql.Open(&quot;mymysql&quot;, &quot;tcp:127.0.0.1:3306*go/root/123456&quot;)
    db, err = sql.Open(&quot;sqlite3&quot;, &quot;./liuyan.db&quot;)
    if err != nil {
        panic(err)
    }
    defer db.Close()
 
    // 准备模板
    err = LoadTemplate()
    if err != nil {
        panic(err)
    }
 
    // 注册处理函数
    http.HandleFunc(&quot;/load&quot;, loadHandler)
    http.HandleFunc(&quot;/&quot;, listHandler)
    http.HandleFunc(&quot;/liuyan&quot;, liuyanHandler)
 
    // 启动服务器
    err = http.ListenAndServe(&quot;:12345&quot;, nil)
    if err != nil {
        panic(err)
    }
}
 
// 加载模板
func LoadTemplate() error {
    // 准备模板函数
    funcs := make(template.FuncMap)
    funcs[&quot;showtime&quot;] = ShowTime
 
    // 准备模板
    v := template.New(&quot;view&quot;)
    v.Funcs(funcs)
 
    _, err := v.ParseGlob(&quot;view/*.htm&quot;)
    if err != nil {
        return err
    }
 
    view = v
    return nil
}
 
// 动态加载模板 /load
func loadHandler(w http.ResponseWriter, req *http.Request) {
    err := LoadTemplate()
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
    io.WriteString(w, `模板加载完成`)
}
 
// 显示留言页面 /
func listHandler(w http.ResponseWriter, req *http.Request) {
    // 查询数据
    rows, err := db.Query(&quot;select * from liuyan&quot;)
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
    defer rows.Close()
 
    // 获取数据
    lys := []Liuyan{}
    for rows.Next() {
        ly := Liuyan{}
        err := rows.Scan(&amp;ly.Id, &amp;ly.Name, &amp;ly.Url, &amp;ly.Content, &amp;ly.Time)
        if nil != err {
            http.Error(w, err.Error(), 500)
            return
        }
        lys = append(lys, ly)
    }
 
    // 显示数据
    err = view.ExecuteTemplate(w, &quot;index.htm&quot;, lys)
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
}
 
// 留言页面 /liuyan
func liuyanHandler(w http.ResponseWriter, req *http.Request) {
    if &quot;POST&quot; == req.Method {
        // 获取参数
        name := strings.TrimSpace(req.FormValue(&quot;name&quot;))
        url := strings.TrimSpace(req.FormValue(&quot;url&quot;))
        content := strings.TrimSpace(req.FormValue(&quot;content&quot;))
 
        // 检查参数
        if name == &quot;&quot; || content == &quot;&quot; {
            io.WriteString(w, &quot;参数错误!\n&quot;)
            return
        }
 
        // sql语句
        sql, err := db.Prepare(&quot;insert into liuyan(name, url, content, time) values(?, ?, ?, ?)&quot;)
        if err != nil {
            http.Error(w, err.Error(), 500)
            return
        }
        defer sql.Close()
 
        // sql参数,并执行
        _, err = sql.Exec(name, url, content, time.Now().Unix())
        if err != nil {
            http.Error(w, err.Error(), 500)
            return
        }
 
        // 跳转
        w.Header().Add(&quot;Location&quot;, &quot;/&quot;)
        w.WriteHeader(302)
 
        // 提示信息
        io.WriteString(w, &quot;提交成功!\n&quot;)
 
        return
    }
 
    // 显示表单
    err := view.ExecuteTemplate(w, &quot;liuyan.htm&quot;, nil)
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
}</pre>

<p>&nbsp;</p>

<p>view/index.htm</p>

<pre class="brush: js;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;&lt;a href=&quot;/liuyan&quot;&gt;给我留言&lt;/a&gt;&lt;/p&gt;
    &lt;table border=&quot;1&quot;&gt;
        &lt;tr&gt;
            &lt;th&gt;编号&lt;/th&gt;&lt;th&gt;姓名&lt;/th&gt;&lt;th&gt;网址&lt;/th&gt;&lt;th&gt;内容&lt;/th&gt;&lt;th&gt;时间&lt;/th&gt;
        &lt;/tr&gt;
{{range .}}
        &lt;tr&gt;
            &lt;td&gt;{{.Id}}&lt;/td&gt;&lt;td&gt;{{.Name|html}}&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;{{.Url}}&quot; target=&quot;_blank&quot;&gt;{{.Url|html}}&lt;/a&gt;&lt;/td&gt;&lt;td&gt;{{.Content|html}}&lt;/td&gt;&lt;td&gt;{{.Time|showtime}}&lt;/td&gt;
        &lt;/tr&gt;
{{end}}
    &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<p>&nbsp;</p>

<p>view/liuyan.htm</p>

<pre class="brush: js;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form method=&quot;post&quot;&gt;
        姓名:&lt;input type=&quot;text&quot; name=&quot;name&quot; /&gt;&lt;br&gt;
        网址:&lt;input type=&quot;text&quot; name=&quot;url&quot; /&gt;&lt;br&gt;
        内容:&lt;input type=&quot;text&quot; name=&quot;content&quot; /&gt;&lt;br&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<p>&nbsp;</p>
</div>

      </div>
      <div class="clearfix"></div>
   </div>


<div class="navigation">

   <div class="pull-left">
      &laquo;
      <a href="/view/74" rel="prev">上篇:golang strconv.ParseInt 的例子</a>
   </div>


   <div class="pull-right">
      <a href="/view/76" rel="next">下篇:golang socket 例子</a>
      &raquo;
   </div>

<div class="clearfix"></div>
</div>

<div class="clearfix"></div>
   <div class="comments well">
      <h3>
         <span class="comment-heading">Comments -</span>
         0 Responses
      </h3>

 
</div>

<div class="clearfix"></div>

<div id="respond" class="respond well">

   <h3>
      <span>Leave a Reply</span>
   </h3>

   <div class="cancel-comment-reply">
      <a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display:none;">Cancel Reply</a>
   </div>

   <div class="clearfix"></div>

   <form action="/new/reply/75" method="post" id="commentform" class="form-horizontal">
      <div class="control-group">
         <label class="control-label" for="author">Name</label>
         <div class="controls">
            <input type="text" class="input-large" name="author" id="author" value="" required></div>
      </div>

      <div class="control-group">
         <label class="control-label" for="email">Email</label>
         <div class="controls">
            <input type="text" class="input-large" name="email" id="email" value="" required></div>
      </div>

      <div class="control-group">
         <label class="control-label" for="website">Website</label>
         <div class="controls">
            <input type="text" class="input-large" name="website" id="website" value="" ></div>
      </div>

      
   <div class="control-group">
      <label class="control-label" for="comment">Comment</label>
      <div class="controls">
         <textarea class="input-xlarge" name="comment" id="comment" rows="8" style="width:78%;"></textarea>
      </div>
   </div>

   <div class="form-actions">
      <input name="submit" type="submit" id="comment-submit" tabindex="5" value="评论" class="btn" />
      <button type="reset" class="btn">清空</button>
   </div>

   <p>
      <input type='hidden' name='comment_userid' value='0' id='comment_userid' />
      <input type='hidden' name='comment_parent' id='comment_parent' value='75' />
   </p>

   <div class="clear"></div>
</form>

</div>


<div class="clearfix"></div>
</div>

<script type="text/javascript">
   $(document).ready(function() {

         function setCookie(name, value) {
            var Days = 60; 
            var exp = new Date(); 
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000); 
            document.cookie = name + "=" + escape(value) + "; path=/; expires=" + exp.toGMTString();
         };

         function getCookie(name) {
             
            var strCookie = document.cookie;
            
            var arrCookie = strCookie.split("; ");
            for ( var i = 0; i < arrCookie.length; i++) {
               var arr = arrCookie[i].split("=");
               if (arr[0] == "username") {
                  return arr[1];
               }
            }
            return "";
         };

         function delCookie(name) {
            var exp = new Date(); 
            exp.setTime(exp.getTime() - 1); 
            var cval = getCookie(name);
            if (cval != null)
               document.cookie = name + "=" + cval + "; path=/; expires="+ exp.toGMTString();
         };

         var now = new Date();
         now.setTime(now.getTime() + 1 * 24 * 60 * 60 * 1000);
         setCookie("gmt",now.toGMTString());

      });

</script>
         </div>

         <div class="span4">
            
               <div class="sidebar">
<div class="widget">
  <h3><span>搜索</span></h3><div class="form">
  <form method="get" id="searchform" action="/search" class="form-search">
  <input type="text" value="" name="keyword" id="keyword" class="input-medium"/>
  <input type="submit" id="searchsubmit" value="搜索" class="btn"/>
  </form>
  </div>
</div>


<div class="widget">
  
  <h3><span>注册登录</span></h3>
  
  <ul>
  
     <li><a href="/register">注册</a></li>
     <li><a href="/login">登录</a></li>
  
  </ul>
</div>


<div class="widget">
  <h3><span>最新话题</span></h3>
  <ul>
  
    
      <li><a href="/view/91" title="Go实现Daemon模式">Go实现Daemon模式</a></li>
    
      <li><a href="/view/90" title="Go 语言中实现优雅的停止程序">Go 语言中实现优雅的停止程序</a></li>
    
      <li><a href="/view/89" title="Go语言获取文件sha1值">Go语言获取文件sha1值</a></li>
    
      <li><a href="/view/88" title="获取文件相关信息">获取文件相关信息</a></li>
    
      <li><a href="/view/87" title="golang分割文件">golang分割文件</a></li>
    
      <li><a href="/view/86" title="golang字符串操作处理包strings">golang字符串操作处理包strings</a></li>
    
      <li><a href="/view/85" title="Go语言中通过结构体匿名字段实现方法的继承和重载">Go语言中通过结构体匿名字段实现方法的继承和重载</a></li>
    
      <li><a href="/view/84" title="golang 获取当天起始时间">golang 获取当天起始时间</a></li>
    
      <li><a href="/view/83" title="[]uint转int64的方法">[]uint转int64的方法</a></li>
    
      <li><a href="/view/82" title="golang websocket 简易聊天室">golang websocket 简易聊天室</a></li>
    
  
  </ul>
</div>

<div class="widget">
  <h3><span>最新节点</span></h3>
  <ul>
  
    
      <li><a href="/node/13" title="html">html</a></li>
    
      <li><a href="/node/12" title="css">css</a></li>
    
      <li><a href="/node/11" title="python">python</a></li>
    
      <li><a href="/node/10" title="gtk系列下载">gtk系列下载</a></li>
    
      <li><a href="/node/9" title="Golang第三方库">Golang第三方库</a></li>
    
      <li><a href="/node/8" title="nginx配置">nginx配置</a></li>
    
      <li><a href="/node/7" title="网站安全">网站安全</a></li>
    
      <li><a href="/node/5" title="linux笔记">linux笔记</a></li>
    
      <li><a href="/node/4" title="golang">golang</a></li>
    
      <li><a href="/node/3" title="站长手记">站长手记</a></li>
    
  
  </ul>
</div>

<div class="widget">
  <h3><span>最新评论</span></h3>
  <ul id="recentcomments">
  
      
      <li class="recentcomments">花樣男 on <a href="/view/91#comment-1499">唔錯唔錯</a></li>
      
      <li class="recentcomments">root on <a href="/view/35#comment-21">@heml，目前我只是简单通过调用imagemagick解决缩略图的问题，没有用golang自带的库</a></li>
      
      <li class="recentcomments">heml on <a href="/view/35#comment-20">感觉golang还是不成熟。
window环境IDE不顺手，也不好调试。
类库也不成熟，用自带的</a></li>
      
      <li class="recentcomments">Steve on <a href="/view/1#comment-18">过来看看 不错哦</a></li>
      
      <li class="recentcomments">heml on <a href="/view/35#comment-17">拼好图之后选择保存就会保存成一张整</a></li>
      
      <li class="recentcomments">heml on <a href="/view/35#comment-16">拼图：用Open选择一个文件夹，会把里面的所有图片拼成一张，游戏中用的是8帧一个动作，所以都是每行8</a></li>
      
      <li class="recentcomments">Insion on <a href="/view/35#comment-15">@heml，编译好你的拼图程序了，但是怎么拼捏？打开图片好像不断往左边跑一样，然后加载其他的图也是这</a></li>
      
      <li class="recentcomments">Insion on <a href="/view/35#comment-14">@heml，请问拼出来的效果怎样</a></li>
      
      <li class="recentcomments">heml on <a href="/view/35#comment-13">感觉拼图太慢了，主要是main.go/composeImg太慢了，不知道是哪里用法不对</a></li>
      
      <li class="recentcomments">root on <a href="/view/35#comment-12">@heml，谢谢分享，我稍后看一下怎么回事~等下得在回复功能上面加个邮件发送通知的功能才行，顺手把a</a></li>
      
  
  </ul>
</div>

<div class="widget">
  <h3><span>博客分类</span></h3>
  <ul>
    
      
        <li class="cat-item"><a href="/category/1">代码</a></li>
      
        <li class="cat-item"><a href="/category/2"> 笔记</a></li>
      
        <li class="cat-item"><a href="/category/3">下载</a></li>
      
        <li class="cat-item"><a href="/category/4">配置</a></li>
      
    
  </ul>
</div>

             </div>
         </div>
      </div>
   </div>
</div>



<footer>
  <div class="container">
    <div class="row">
      
         <div class="span4">
                        <div class="fwidget">
               <h4>About SudoChina</h4>
               <p>速动中国是借力开源技术打造的站长技术交流平台，在这里我们会分享开源技术及站长软件工具，分享运营经验和站长行业交流！欢迎大家注册，享受分享知识的乐趣，请收藏！</p>
            </div>
                     </div>
         <div class="span4">
                        <div class="fwidget">
               <h4>Recent Comments</h4>
               <ul>
                
                  
                  <li>花樣男 on <a href="/view/91#comment-1499">唔錯唔錯</a></li>
                  
                  <li>root on <a href="/view/35#comment-21">@heml，目前我只是简单通过调用imagemagick解决缩略图的问题，没有用golang自带的库</a></li>
                  
                  <li>heml on <a href="/view/35#comment-20">感觉golang还是不成熟。
window环境IDE不顺手，也不好调试。
类库也不成熟，用自带的</a></li>
                  
                  <li>Steve on <a href="/view/1#comment-18">过来看看 不错哦</a></li>
                  
                  <li>heml on <a href="/view/35#comment-17">拼好图之后选择保存就会保存成一张整</a></li>
                  
                
               </ul>
            </div>     
         </div>
         <div class="span4">
                        <div class="fwidget">
               <h4>Categories</h4>
               <ul>
                
                  
                    <li><a href="/category/1">代码</a></li>
                  
                    <li><a href="/category/2"> 笔记</a></li>
                  
                    <li><a href="/category/3">下载</a></li>
                  
                    <li><a href="/category/4">配置</a></li>
                  
                
               </ul>
            </div>   
                     </div>
      <div class="span12">
         <div class="copy">
            <p>Copyright &copy; 2013 - <a href="/">SudoChina.com.</a> Powered by <a href="https://github.com/insionng/toropress" target="_blank">ToroPress</a>. <script src="http://s21.cnzz.com/stat.php?id=4835781&web_id=4835781" language="JavaScript"></script>
            </p>
         </div>
      </div>
    </div>
  <div class="clearfix"></div>
  </div>
</footer>       


<script src="/static/js/bootstrap.js"></script>
</body>
</html>