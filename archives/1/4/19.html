<!DOCTYPE html>
<html lang="zh-CN">
    <head>  
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
    <meta name="description" content="toropress" />
    <meta name="keywords" content="toropress" />
    <meta name="author" content="insion"/>
    
    <title>Toropress</title>
  <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
  
  
  <link href="/static/themes/nannie/css/bootstrap.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/themes/nannie/css/font-awesome.css">
        
  <link href="/static/themes/nannie/css/style.css" rel="stylesheet">
  <link href="/static/themes/nannie/css/bootstrap-responsive.css" rel="stylesheet">
  

  
    
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/static/ico/apple-touch-icon-57-precomposed.png">

<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
   
</head>

<body>


<header>
   <div class="container">
      <div class="row">
         <div class="span4">
            <div class="logo">
               
               <a href="/"><h1>Insion.<span class="color">Co</span></h1></a>
               <p class="lmeta">Toropress，又一个Toropress..</p>
            </div>
         </div>
         
      </div>
   </div>
</header>

         <div class="navbar">
            <div class="navbar-inner">
               <div class="container">
                  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                     <span>菜单</span>
                  </a>
                  <div class="nav-collapse collapse">
                      <ul class="nav">
                        <ul id="menu-menu" class="nav">
                          <li id="menu-item-30" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-30"><a href="/">首页</a></li>
                        
                          
                            <li class="menu-item"><a href="/category/1">代码</a></li>
                          
                            <li class="menu-item"><a href="/category/2"> 笔记</a></li>
                          
                            <li class="menu-item"><a href="/category/3">文学</a></li>
                          
                        
                        </ul>
                      </ul>
                  </div>
               </div>
            </div>
         </div>



<div class="content">
   <div class="container">
      <div class="row">
         <div class="span8">
          
<h3 style="display:none"><span>Post</span></h3>
<div class="posts">
                                    
               <div class="entry" id="post-27">
                  <div class="matter">
                  
                     <h2>golang指针的用法.</h2>
                     
                     <div class="meta"><i class="icon-calendar"></i> March 16 , 2013 at 17:55 am - <i class="icon-folder-open"></i> <a href="/user/0/" title="View all posts in Etiam" rel="category tag">Insion</a> - <i class="icon-comment"></i> <a href="http://responsivewebinc.com/nannie/suspendisse-eget-lorem-dui/#comments" title="Comment on Suspendisse eget lorem dui">0 Comments</a></div>
                     
                     <div><p>总结一下golang中的指针与C语言的指针的用法.</p>

<p>总体一致:&nbsp;<br />
C的代码:<br />
&nbsp; &nbsp; int *number;<br />
&nbsp; &nbsp; number = (int *) malloc(sizeof(int));<br />
&nbsp; &nbsp; *number = 3;<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, *number);</p>

<p>golang的代码:<br />
&nbsp; &nbsp; var pointer *int;<br />
&nbsp; &nbsp; pointer = new(int);<br />
&nbsp; &nbsp; *pointer = 3;<br />
&nbsp; &nbsp; fmt.Println(*pointer);</p>

<p>多重指针情况:<br />
C的代码:<br />
&nbsp; &nbsp; int **outer;<br />
&nbsp; &nbsp; int *inter;<br />
&nbsp; &nbsp; inter = (int *) malloc(sizeof(int));</p>

<p>&nbsp; &nbsp; *inter = 3;<br />
&nbsp; &nbsp; outer = &amp;inter;<br />
&nbsp; &nbsp; //地址一样<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, inter);<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, *outer);<br />
&nbsp; &nbsp; //值一样<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, *inter);<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, **outer);</p>

<p>golang的代码:<br />
&nbsp; &nbsp; var outer **int;<br />
&nbsp; &nbsp; var inter *int;<br />
&nbsp; &nbsp; inter = new(int);<br />
&nbsp; &nbsp; *inter = 3;<br />
&nbsp; &nbsp; outer = &amp;inter;<br />
&nbsp; &nbsp; //地址一样<br />
&nbsp; &nbsp; fmt.Println(inter);<br />
&nbsp; &nbsp; fmt.Println(*outer);<br />
&nbsp; &nbsp; //值一样<br />
&nbsp; &nbsp; fmt.Println(*inter);<br />
&nbsp; &nbsp; fmt.Println(**outer);</p>

<p>C语言的下面这种方式在golang里实现:<br />
&nbsp; &nbsp; int **outer;<br />
&nbsp; &nbsp; int *inter;<br />
&nbsp; &nbsp; inter = (int *) malloc(sizeof(int));<br />
&nbsp; &nbsp; outer = (int **) malloc(sizeof(int));<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; *inter = 3;<br />
&nbsp; &nbsp; *outer = inter;<br />
&nbsp; &nbsp; //地址一样<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, inter);<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, *outer);<br />
&nbsp; &nbsp; //值一样<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, *inter);<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, **outer);</p>

<p>在golang中:<br />
&nbsp; &nbsp; var inter *int;<br />
&nbsp; &nbsp; var outer **int;<br />
&nbsp; &nbsp; inter = new(int);<br />
&nbsp; &nbsp; *inter = 3;<br />
&nbsp; &nbsp; outer = new(*int);<br />
&nbsp; &nbsp; *outer = inter;<br />
&nbsp; &nbsp; //地址一样<br />
&nbsp; &nbsp; fmt.Println(inter);<br />
&nbsp; &nbsp; fmt.Println(*outer);<br />
&nbsp; &nbsp; //值一样<br />
&nbsp; &nbsp; fmt.Println(*inter);<br />
&nbsp; &nbsp; fmt.Println(**outer);</p>

<p>上面都是在玩指针, 下面看看基本的数据结构</p>

<p>基本的数据结构有: 数组与结构体 (map和树之类的不在討論范围)</p>

<p>golang中的数组与C中的数组有很大的差别</p>

<p>golang中的数组是这样说的: Arrays are values, not implicit pointers as in C.</p>

<p>0. 数组做参数时, 需要被检查长度.<br />
1. 变量名不等于数组开始指针!<br />
2. 不支持C中的*(ar + sizeof(int))方式的指针移动. 需要使用到unsafe包<br />
3. 如果p2array为指向数组的指针， *p2array不等于p2array[0]<br />
例子0 数组做参数时, 需要被检查长度.</p>

<p>func use_array( args [4]int ){<br />
&nbsp; &nbsp; args[1] = 100;<br />
}</p>

<p>func main() {<br />
&nbsp; &nbsp; var args = [5]int{1, 2, 3, 4, 5};<br />
&nbsp; &nbsp; use_array(args);<br />
&nbsp; &nbsp; fmt.Println(args);<br />
}</p>

<p>编译出错: cannot use args (type [5]int) as type [4]int in function argument, 需要有长度上的检查<br />
例子1 变量名不等于数组开始指针!</p>

<p>func use_array( args [4]int ){<br />
&nbsp; &nbsp; args[1] = 100;<br />
}</p>

<p>func main() {<br />
&nbsp; &nbsp; var args = [5]int{1, 2, 3, 4, 5};<br />
&nbsp; &nbsp; use_array(args);<br />
&nbsp; &nbsp; fmt.Println(args);<br />
}</p>

<p>输出結果是 [1 2 3 4], 没有保存結果, 数组名的用法与C的不一样. 在golang里是这样的:</p>

<p>// 又长度检查, 也为地址传参<br />
func use_array( args *[4]int ){<br />
&nbsp; &nbsp; args[1] = 100; &nbsp;//但是使用还是和C一致, 不需要别加&quot;*&quot;操作符<br />
}<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />
func main() { &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; var args = [4]int{1, 2, 3, 4};<br />
&nbsp; &nbsp; use_array(&amp;args); //数组名已经不是表示地址了, 需要使用&quot;&amp;&quot;得到地址<br />
&nbsp; &nbsp; fmt.Println(args);<br />
}</p>

<p>例子2 如果p2array为指向数组的指针， *p2array不等于p2array[0]<br />
对比一下C和golang在这方面的差别：<br />
void main(int argc, char *argv[]){<br />
&nbsp; &nbsp; int *p2array;<br />
&nbsp; &nbsp; p2array = (int *) malloc(sizeof(int) * 3);<br />
&nbsp; &nbsp; //等于p2array[0]<br />
&nbsp; &nbsp; *p2array = 0;<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, *p2array + 1);<br />
}<br />
* 输出为1</p>

<p>func main() {<br />
&nbsp; &nbsp; var p2array *[3]int ;<br />
&nbsp; &nbsp; p2array = new([3]int);<br />
&nbsp; &nbsp; fmt.Printf(&quot;%x\n&quot;, *p2array + 1); //不管p2array是指针变量还是数组变量, 都只能使用&quot;[]&quot;方式使用<br />
}<br />
* 报错.<br />
golang中的结构体也与C中的有差别</p>

<p><br />
下面的方式是相当一致的:<br />
C版本的:<br />
&nbsp; &nbsp; typedef struct<br />
&nbsp; &nbsp; { &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; int x;<br />
&nbsp; &nbsp; &nbsp; &nbsp; int y;<br />
&nbsp; &nbsp; } Point;</p>

<p>&nbsp; &nbsp; Point p;<br />
&nbsp; &nbsp; p.x = 10;<br />
&nbsp; &nbsp; p.y = 20;<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; //开始地址<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, &amp;p);<br />
&nbsp; &nbsp; //某元素地址<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, &amp;(p.x));</p>

<p>golang版本的:<br />
&nbsp; &nbsp; type Point struct{<br />
&nbsp; &nbsp; &nbsp; &nbsp; x int;<br />
&nbsp; &nbsp; &nbsp; &nbsp; y int;<br />
&nbsp; &nbsp; };<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; var p Point;<br />
&nbsp; &nbsp; p.x = 10;<br />
&nbsp; &nbsp; p.y = 20;<br />
&nbsp; &nbsp; fmt.Printf(&quot;%p\n&quot;, &amp;p);<br />
&nbsp; &nbsp; fmt.Printf(&quot;%p\n&quot;, &amp;(p.x));</p>

<p>使用allocate的方式:<br />
C代码:<br />
&nbsp; &nbsp; typedef struct<br />
&nbsp; &nbsp; { &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; int x;<br />
&nbsp; &nbsp; &nbsp; &nbsp; int y;<br />
&nbsp; &nbsp; } Point;</p>

<p>&nbsp; &nbsp; Point *p;<br />
&nbsp; &nbsp; p = (Point *) malloc(sizeof(Point));<br />
&nbsp; &nbsp; p-&gt;x = 10;<br />
&nbsp; &nbsp; p-&gt;y = 20;<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; //开始地址<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, p); //地址<br />
&nbsp; &nbsp; //某元素地址<br />
&nbsp; &nbsp; printf(&quot;%p\n&quot;, &amp;(p-&gt;x));</p>

<p>golang代码:<br />
&nbsp; &nbsp; type Point struct{<br />
&nbsp; &nbsp; &nbsp; &nbsp; x int;<br />
&nbsp; &nbsp; &nbsp; &nbsp; y int;<br />
&nbsp; &nbsp; };<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; var p *Point;<br />
&nbsp; &nbsp; p = new(Point);<br />
&nbsp; &nbsp; p.x = 10;<br />
&nbsp; &nbsp; p.y = 20;<br />
&nbsp; &nbsp; fmt.Printf(&quot;%p\n&quot;, p); //地址<br />
&nbsp; &nbsp; fmt.Printf(&quot;%p\n&quot;, &amp;(p.x));</p>

<p>也可以说是一样的, 只不过在使用结构中的元素时没有了&quot;-&gt;&quot;操作符:<br />
There is no -&gt; notation for structure pointers. Go provides the indirection for you. &nbsp;&nbsp;</p>

<p>结构体的地址传参与数组的方式一样, 当然, 和C的风格也是一模一样的. 如下例子:</p>

<p>C代码:<br />
#include &lt;stdio.h&gt;<br />
#include &lt;stdlib.h&gt;<br />
typedef struct<br />
&nbsp; &nbsp; {<br />
&nbsp; &nbsp; &nbsp; &nbsp; int x;<br />
&nbsp; &nbsp; &nbsp; &nbsp; int y;<br />
&nbsp; &nbsp; } Point;<br />
&nbsp; &nbsp;&nbsp;<br />
void use_struct(Point *arg){<br />
&nbsp; &nbsp; arg-&gt;x = 100;<br />
}</p>

<p>void main(int argc, char *argv[]){<br />
&nbsp; &nbsp;&nbsp;<br />
&nbsp; &nbsp; Point *p;<br />
&nbsp; &nbsp; p = (Point *) malloc(sizeof(Point));<br />
&nbsp; &nbsp; p-&gt;x = 10;<br />
&nbsp; &nbsp; p-&gt;y = 20;<br />
&nbsp; &nbsp;&nbsp;<br />
&nbsp; &nbsp; use_struct(p);<br />
&nbsp; &nbsp; printf(&quot;%d\n&quot;, p-&gt;x);</p>

<p>}</p>

<p>golang代码:<br />
import &quot;fmt&quot;</p>

<p>type Point struct{<br />
&nbsp; &nbsp; x int;<br />
&nbsp; &nbsp; y int;<br />
};</p>

<p>func use_sturct( p *Point ){<br />
&nbsp; &nbsp; p.x = 100;<br />
}</p>

<p>func main() {</p>

<p>&nbsp; &nbsp; var p *Point;<br />
&nbsp; &nbsp; p = new(Point);<br />
&nbsp; &nbsp; p.x = 10;<br />
&nbsp; &nbsp; p.y = 20;<br />
&nbsp; &nbsp; use_sturct(p);<br />
&nbsp; &nbsp; fmt.Printf(&quot;%d\n&quot;, p.x);<br />
}</p>

<p>总的来说......</p>

<p>在传参方面, 大体上看与C的相同:</p>

<p>&nbsp; f(ar); &nbsp; &nbsp;// passes a copy of ar&nbsp;</p>

<p>&nbsp; fp(&amp;ar); &nbsp;// passes a pointer to ar<br />
* 只是变量名是不是表示首个地址 有区别</p>

<p><br />
&quot;&amp;&quot; 与C语言一样是得到变量的指针. 与C有点不同， 取golang中指针指针的内容的值是不需要使用&quot;*&quot;操作符的， 但是指针的指针(或者继续多层时)需要显式使用&quot;*&quot;符号.<br />
在http://golang.org/doc/go_spec.html#Selectors 一节中有描述。</p>

<p>* 三层以上的指针使用是比较少的. 两层还是常见, 如main函数的参数char * argv[]</p>
</div>
                     Tags: <a href="http://responsivewebinc.com/nannie/tag/condimen/" rel="tag">condimen</a> <a href="http://responsivewebinc.com/nannie/tag/lobor/" rel="tag">lobor</a>                  </div>
                  <div class="clearfix"></div>
               </div>
               
                

 
<div class="comments well">
<h3><span class="comment-heading">Comments - </span>0 Responses</h3>
 




</div>

<div class="navigation">
<div class="pull-left"><a href="/comment-page-1/#comments" >&laquo; Older Comments</a></div>
<div class="pull-right"></div>
</div>

<div class="clearfix"></div>

 
 
<div id="respond" class="respond well">
 
<h3><span>Leave a Reply</span></h3>
 
<div class="cancel-comment-reply">
<a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display:none;">Cancel Reply</a></div>

<div class="clearfix"></div>
 

<form action="/view/19" method="post" id="commentform" class="form-horizontal">
      <div class="control-group">
         <label class="control-label" for="author">Name</label>
         <div class="controls">
            <input type="text" class="input-large" name="author" id="author" value="root" required>
         </div>
      </div>  

      <div class="control-group">
         <label class="control-label" for="email">Email</label>
         <div class="controls">
            <input type="text" class="input-large" name="email" id="email" value="root@insion.co" required>
         </div>
      </div>

      <div class="control-group">
         <label class="control-label" for="website">Website</label>
         <div class="controls">
            <input type="text" class="input-large" name="website" id="website" value="" >
         </div>
      </div> 
	
 

 
      <div class="control-group">
         <label class="control-label" for="comment">Comment</label>
         <div class="controls">
            <textarea class="input-xlarge" name="comment" id="comment" rows="8" style="width:80%;"></textarea>
         </div>
      </div> 

      <div class="form-actions">
         <input name="submit" type="submit" id="comment-submit" tabindex="5" value="评论" class="btn" />
         <button type="reset" class="btn">清空</button>
      </div>
 
<p>
<input type='hidden' name='comment_userid' value='4' id='comment_userid' />
<input type='hidden' name='comment_parent' id='comment_parent' value='19' />
</p>

<div class="clear"></div>
</form>
 
</div>

            
   <div class="navigation">
      <div class="pull-left">&laquo; <a href="http://responsivewebinc.com/nannie/ut-consectetur-ultricies-consequat/" rel="prev">Ut consectetur ultricies consequat</a></div>
      <div class="pull-right"></div>
      <div class="clearfix"></div>
   </div>  
   <div class="clearfix"></div>
               
</div>
            

         </div>

         <div class="span4">
            
               <div class="sidebar">
<div class="widget">
  <h3><span>搜索</span></h3><div class="form">
  <form method="get" id="searchform" action="/search" class="form-search">
  <input type="text" value="" name="keyword" id="keyword" class="input-medium"/>
  <input type="submit" id="searchsubmit" value="搜索" class="btn"/>
  </form>
  </div>
</div>


<div class="widget">
  <h3><span>管理，root</span></h3>
  <ul>
     <li><a href="/new/category">新建分类</a></li>
     <li><a href="/new/node">新建节点</a></li>
     <li><a href="/new/topic">新建话题</a></li>
     <li><a href="/modify/category">修改分类</a></li>
     <li><a href="/modify/node">修改节点</a></li>
     <li><a href="/logout">退出</a></li>
  </ul>
</div>
<div class="widget">
  <h3><span>危险操作</span></h3>
  <ul>
     <li><a href="/delete/category">删除分类</a></li>
     <li><a href="/delete/node">删除节点</a></li>
     <li><a href="/delete/topic">删除话题</a></li>
     <li><a href="/delete/user">删除用户</a></li>
  </ul>
</div>


<div class="widget">
  <h3><span>最新10个节点</span></h3>
  <ul>
  
    
      <li><a href="/node/4" title="golang">golang</a></li>
    
      <li><a href="/node/3" title="站长技巧">站长技巧</a></li>
    
      <li><a href="/node/2" title="编程笔记">编程笔记</a></li>
    
      <li><a href="/node/1" title="祭奠青春">祭奠青春</a></li>
    
  
  </ul>
</div>

<div class="widget">
  <h3><span>最新10条评论</span></h3>
  <ul id="recentcomments">
  
      
      <li class="recentcomments">ID:1 on <a href="/view/1#comment-2">失去了年华，容颜退却~</a></li>
      
  
  </ul>
</div>

<div class="widget">
  <h3><span>博客分类</span></h3>
  <ul>
    
      
        <li class="cat-item"><a href="/category/1">代码</a></li>
      
        <li class="cat-item"><a href="/category/2"> 笔记</a></li>
      
        <li class="cat-item"><a href="/category/3">文学</a></li>
      
    
  </ul>
</div>

             </div>
         </div>
      </div>
   </div>
</div>



<footer>
  <div class="container">
    <div class="row">
      
         <div class="span4">
                        <div class="fwidget">
               <h4>About Insion.Co</h4>
               <p>Insion.Co是基于toropress搭建的中文博客，欢迎大家收藏！</p>
            </div>
                     </div>
         <div class="span4">
                        <div class="fwidget">
               <h4>Recent Comments</h4>
               <ul>
                
                  
                  <li>ID:1 on <a href="/view/1#comment-2">失去了年华，容颜退却~</a></li>
                  
                
               </ul>
            </div>     
         </div>
         <div class="span4">
                        <div class="fwidget">
               <h4>Categories</h4>
               <ul>
                
                  
                    <li><a href="/category/1">代码</a></li>
                  
                    <li><a href="/category/2"> 笔记</a></li>
                  
                    <li><a href="/category/3">文学</a></li>
                  
                
               </ul>
            </div>   
                     </div>
      <div class="span12">
         <div class="copy">
            <p>Copyright &copy; 2013 - <a href="/">Insion Co.</a> Powered by <a href="https://github.com/insionng/toropress" target="_blank">ToroPress</a>. <script src="http://s25.cnzz.com/stat.php?id=5052969&web_id=5052969&online=1&show=line" language="JavaScript"></script>
            </p>
         </div>
      </div>
    </div>
  <div class="clearfix"></div>
  </div>
</footer>       


<script src="/static/js/jquery-1.8.2.js"></script>
<script src="/static/js/bootstrap.js"></script>
</body>
</html>